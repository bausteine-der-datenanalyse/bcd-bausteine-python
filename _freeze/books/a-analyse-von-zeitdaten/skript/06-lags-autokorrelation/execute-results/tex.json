{
  "hash": "818ce54391e10ebc3e1150e5c642e52a",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"6 Lags & Autokorrelation\"\n---\n\n# 6 Lags & Autokorrelation\n\nZeitreihen unterscheiden sich von klassischen Datensätzen,\nweil Beobachtungen **nicht unabhängig** sind.\n\nDer Wert zum Zeitpunkt t hängt häufig von vorherigen Werten ab.\n\nDiese zeitliche Abhängigkeit untersuchen wir mit:\n\n- **Lags**\n- **Autokorrelation**\n\n---\n\n::: {.callout-note title=\"Merke\"}\nZeitliche Abhängigkeit ist eine zentrale Eigenschaft von Zeitreihen.\nOhne sie gäbe es keine sinnvolle Prognose.\n:::\n\n---\n\n## 6.1 Beispielsignal\n\n::: {.cell execution_count=1}\n``` {.python .cell-code}\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\n\nrng = np.random.default_rng(21)\n\nt = pd.date_range(\"2025-01-01\", periods=24*14, freq=\"H\")\ntrend = np.linspace(0, 2, len(t))\nseason = 0.8 * np.sin(2*np.pi*(t.hour)/24)\nnoise = 0.4 * rng.normal(size=len(t))\n\ns = pd.Series(15 + trend + season + noise, index=t, name=\"signal\")\n\ns.plot(title=\"Beispielsignal\")\nplt.show()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n/var/folders/p_/ks3trxjx0jd839_g4g0vm4nc0000gn/T/ipykernel_21355/1570465617.py:7: FutureWarning: 'H' is deprecated and will be removed in a future version, please use 'h' instead.\n  t = pd.date_range(\"2025-01-01\", periods=24*14, freq=\"H\")\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](06-lags-autokorrelation_files/figure-pdf/cell-2-output-2.png){fig-pos='H'}\n:::\n:::\n\n\n---\n\n## 6.2 Lag-Features\n\nEin Lag verschiebt die Zeitreihe nach hinten.\n\n::: {.panel-tabset}\n\n## Pandas\n\n::: {.cell execution_count=2}\n``` {.python .cell-code}\nlag_1h = s.shift(1)\nlag_24h = s.shift(24)\n\ndf_lags = pd.DataFrame({\n    \"y\": s,\n    \"lag_1h\": lag_1h,\n    \"lag_24h\": lag_24h\n})\n\ndf_lags.head()\n```\n\n::: {.cell-output .cell-output-display execution_count=2}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>y</th>\n      <th>lag_1h</th>\n      <th>lag_24h</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>2025-01-01 00:00:00</th>\n      <td>15.143509</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>2025-01-01 01:00:00</th>\n      <td>15.817296</td>\n      <td>15.143509</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>2025-01-01 02:00:00</th>\n      <td>14.697408</td>\n      <td>15.817296</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>2025-01-01 03:00:00</th>\n      <td>16.258241</td>\n      <td>14.697408</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>2025-01-01 04:00:00</th>\n      <td>15.697774</td>\n      <td>16.258241</td>\n      <td>NaN</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n## NumPy (Prinzip)\n\n::: {.cell execution_count=3}\n``` {.python .cell-code}\ny = s.to_numpy()\n\nlag1 = np.roll(y, 1)\nlag24 = np.roll(y, 24)\n\nlag1[0] = np.nan\nlag24[:24] = np.nan\n```\n:::\n\n\n:::\n\n---\n\n::: {.callout-tip title=\"Interpretation\"}\nEin hoher Zusammenhang zwischen y(t) und y(t-24)\ndeutet auf eine Tagesperiodik hin.\n:::\n\n---\n\n## 6.3 Autokorrelation berechnen\n\nAutokorrelation misst die Korrelation zwischen\ny(t) und y(t-k).\n\n::: {.panel-tabset}\n\n## Pandas\n\n::: {.cell execution_count=4}\n``` {.python .cell-code}\nlags = range(1, 49)\nac = [s.corr(s.shift(k)) for k in lags]\n\nplt.stem(list(lags), ac)\nplt.title(\"Autokorrelation (1–48 Stunden)\")\nplt.xlabel(\"Lag (h)\")\nplt.ylabel(\"Korrelation\")\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](06-lags-autokorrelation_files/figure-pdf/cell-5-output-1.png){fig-pos='H'}\n:::\n:::\n\n\n## NumPy (Prinzip)\n\n::: {.cell execution_count=5}\n``` {.python .cell-code}\nimport numpy as np\n\ny = s.to_numpy()\ny = y - np.nanmean(y)\n\ndef autocorr(y, k):\n    return np.corrcoef(y[:-k], y[k:])[0,1]\n\nlags = range(1, 49)\nac_np = [autocorr(y, k) for k in lags]\n\nplt.stem(list(lags), ac_np)\nplt.title(\"Autokorrelation (NumPy)\")\nplt.xlabel(\"Lag\")\nplt.ylabel(\"Korrelation\")\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](06-lags-autokorrelation_files/figure-pdf/cell-6-output-1.png){fig-pos='H'}\n:::\n:::\n\n\n:::\n\n---\n\n## 6.4 Interpretation der Autokorrelation\n\nTypische Muster:\n\n- Langsam abfallende Kurve → starker Trend\n- Periodische Peaks (z. B. bei 24, 48, 72) → Saison\n- Schneller Abfall gegen 0 → schwache Abhängigkeit\n\n---\n\n::: {.callout-warning title=\"Achtung\"}\nTrend kann Autokorrelation künstlich erhöhen.\nGegebenenfalls zuerst detrenden oder differenzieren.\n:::\n\n---\n\n## 6.5 Mini-Aufgaben\n\n1. Entfernen Sie den Trend (z. B. durch Rolling Mean).  \n   - Wie verändert sich die Autokorrelation?\n\n2. Erzeugen Sie eine Zeitreihe ohne Saison.  \n   - Wie sieht die Autokorrelationsfunktion aus?\n\n3. Erzeugen Sie reine Zufallsdaten.  \n   - Was erwarten Sie?\n\n",
    "supporting": [
      "06-lags-autokorrelation_files/figure-pdf"
    ],
    "filters": []
  }
}